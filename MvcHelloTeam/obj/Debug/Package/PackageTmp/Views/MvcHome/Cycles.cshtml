@using System.Web.Mvc.Html
@using MemberCenter20NS.Models;
@using System.Data;
@using System.Web.Mvc;
@using MemberCenter20NS.Controllers;
@model MemberCenter20NS.Models.ClassRoomDataCenterCycles


@{
    ViewBag.Title = "Cycles";
    ViewBag.BodyClass = "Cycles";
}
<!DOCTYPE html>
<html lang="en">
    @Html.Partial("Header")
    <body class="@ViewBag.BodyClass">
           @Html.Partial("Navbar")
        
  
        <body>
            <h3>
                Cycle Records
            </h3>
            <div class="hero-unit">
                <div class="row">
                    <div class="span3">
                        <label for="schoolYearSelect">
                            School Year
                        </label>
                        <select data-placeholder="Select..." id="yearSel" name="schoolYearSelect" class="span2" onchange="YearSelect(this)">
                            @foreach (var year in Model.SchoolYears.SchoolYears)
                            {
                    
                                <option value="@year.Value">@year.Text</option>
                            }
                        </select>
                    </div>
                    <div class="span3">
                        <div class="control-group">
                            <label for="gradingPeriodSelect">
                                Grading Period
                            </label>
                            <select data-placeholder="Select..."id="gpSel" name="gradingPeriodSelect" class="span2" onchange="GradingPeriod(this)">
                                @foreach (var gp in Model.GradingPeriod.GradingPeriods)
                                {
                                    <option value="@gp.Value">@gp.Text</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="control-group">
                            <label for="classroomSelect">
                                Classroom
                            </label>
                            <select data-placeholder="Select..." id="classSelId" name="classroomSelect" class="span6" onchange="LessonSelected(this)">
                                @foreach (var cRoom in Model.Classrooms.Classrooms)
                                {
                                    <option value="@cRoom.Value">@cRoom.Text</option>
                                }
                            </select>
             
                        </div>
                    </div>
                </div>
                <div class="span10 nestedContentDivOpaque" id="lessonListId">
                    @Html.Partial("ClassLessons", Model)
                </div>
                <div class="span10">
                    <p>
                        <span class="standardSFAFHighlightText2">
                            Class *:
                        </span>
                        <span style="color: #9e9e9e; font-size: 11px;">
                            <i>
                                &nbsp;a list of teachers &amp; classrooms with assigned students for the
                                selected grading period. If you do not see your classroom(s) in the list,
                                please contact the school facilitator to setup teachers, students, and
                                classroom assignments for the selected grading period and your classroom(s)
                                will appear in the classrooms list. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
                            </i>
                        </span>
                    </p>
                </div>
            </div>
            <div class="container">
            </div>
            <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
            </script>
            <script type="text/javascript" src="../../Scripts/bootstrap.js">
            </script>
     
            <script type="text/javascript">
                function YearSelect(sel) {
                    var yearVal = sel.options[sel.selectedIndex].value;
                    var gradeSel = document.getElementById('gpSel');
                    var gradeVal = gradeSel.options[gradeSel.selectedIndex].value;
                    loadTeacherLessons(yearVal, gradeVal);
                }
          
            </script>
            <script type="text/javascript">
                function GradingPeriod(sel) {
                    var gradeVal = sel.options[sel.selectedIndex].value;
                    var yearSel = document.getElementById('yearSel');
                    var yearVal = yearSel.options[yearSel.selectedIndex].value;
                    loadTeacherLessons(yearVal, gradeVal);
                }
            </script>
            <script type="text/javascript">
                function loadTeacherLessons(yearVal, gradeVal) {
                    $.ajax(
                        {
                            url: '@Url.Action("GetClassRooms", "MvcHome")',
                            type: "POST",
                            data: { schoolYearId: yearVal, gradingPeriodId: gradeVal },
                            success: function (data) {
                                if (!data)
                                    alert("no data");
                                else {
                                    $('#classSelId')
                                        .find('option').remove();
                                    $.each(data.Classrooms, function (index, val) {
                                        $('#classSelId')
                                            .append($("<option></option>")
                                                .attr("value", val.Value)
                                                .text(val.Text));
                                  
                                    });
                                }

                            }
                        });
                }

        
            </script>
            <script type="text/javascript">
                function LessonSelected(sel) {
                    var lessonVal = sel.options[sel.selectedIndex].value;
                    var yearSel = document.getElementById('yearSel')
                    var yearVal = yearSel.options[yearSel.selectedIndex].value;
                    var gradeSel = document.getElementById('gpSel');
                    var gradeVal = gradeSel.options[gradeSel.selectedIndex].value;
                    //$("#lessonListId").load('@Url.Action("GetClassLessons","MvcHome" )');
                    $.ajax(
                        {
                            url: '@Url.Action("GetClassLessons", "MvcHome")',
                            type: "POST",
                            data: { schoolYearId: yearVal, gradingPeriodId: gradeVal, classroomAssignId: lessonVal },
                            success: function (data) {
                                if (!data)
                                    alert("no data");
                                else {
                           
                                    $("#lessonListId").html(data);

                                }
                            }
                        });

                }
            </script>
        </body>
        @* 
    Optional way of filling DropLists
    @Html.DropDownListFor(x=>x.SchoolYears.SchoolYearID, new SelectList(Model.SchoolYears.SchoolYears,"Value","Text"))
    @Html.DropDownList("SchoolYearID", Model.GradingPeriodList.GradingPeriods, "")
    @Html.DropDownList("Classroom",Model.Classrooms.Classrooms,"")
    *@

    </body>
</html>